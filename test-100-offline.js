/**
 * 100 é—®ç¦»çº¿å‹åŠ›æµ‹è¯• - ç›´æ¥æµ‹è¯•åˆ†ç±»é€»è¾‘
 */

const manifest = require("./app/lib/kb/manifest.json");

function loadKB() {
  const result = {};
  for (const fname of manifest.kb_files) {
    const data = require(`./app/lib/kb/${fname}`);
    const entries = data.entries || data.constitution || data.rules || data.terms || data.status || data.templates || data.page_guides || data.subscription;
    if (!entries) throw new Error(`No valid entries in ${fname}`);
    const cat = fname.replace('.json', '');
    result[cat] = entries;
  }
  return result;
}

const KB_FILES = loadKB();

const DECISION_WORDS = ["æ€ä¹ˆåŠ", "èƒ½ä¸èƒ½", "è¦ä¸è¦", "å¯ä»¥å—", "é€‚åˆ", "åº”è¯¥", "ä»“ä½", "é£é™©", "çŸ­çº¿", "æ³¢æ®µ", "è§‚æœ›", "æ˜¨å¤©", "æŒç»­", "çŠ¶æ€", "å¸‚åœº", "è¡Œæƒ…", "å¤§è·Œ", "åŠ ä»“", "å‡ä»“", "æ»¡ä»“", "è½»ä»“", "é˜²å®ˆ", "è¿›æ”»", "è¶‹åŠ¿", "åŒºé—´", "å±é™©", "é¡ºé£", "é€†é£", "äº¤æ˜“", "çºªå¾‹", "é¢„æœŸ", "ä¾æ®", "ä»£ä»·", "æ”¹å–„", "å¿è€", "è¡ŒåŠ¨"];
const JUDGEMENT_WORDS = ["åå¤š", "åç©º", "ç‰›å¸‚", "ç†Šå¸‚", "éœ‡è¡", "åå¼¹", "ä¸‹è·Œ", "ç­‘åº•", "æƒ…ç»ª", "åŸºæœ¬é¢", "é¡ºåŠ¿", "é€†åŠ¿", "æˆåŠŸç‡", "é è°±", "å®‰å…¨", "ç¡®å®š", "é”™è¯¯", "æ³¨æ„", "ä¿¡å·", "å†å²", "æœºæ„", "ç­–ç•¥", "ç°è´§", "è­¦æƒ•", "é—®é¢˜", "ç±»ä¼¼"];

function normalize(s) {
  return s.toLowerCase().replace(/\s+/g, "").replace(/[ï¼Œã€‚ï¼Ÿï¼ã€ï¼šï¼›""'']/g, "");
}

function matchStatusKB(s) {
  for (const item of KB_FILES.status || []) {
    for (const t of item.triggers) {
      if (s.includes(t.toLowerCase())) {
        return { id: item.id, a: item.a };
      }
    }
  }
  return null;
}

function matchKB(s) {
  for (const cat of manifest.match_policy.priority_order) {
    const items = KB_FILES[cat] || [];
    for (const item of items) {
      for (const t of item.triggers) {
        if (s === t.toLowerCase()) return { id: item.id, a: item.a };
      }
    }
  }
  for (const cat of manifest.match_policy.priority_order) {
    const items = KB_FILES[cat] || [];
    for (const item of items) {
      for (const t of item.triggers) {
        if (s.includes(t.toLowerCase())) return { id: item.id, a: item.a };
      }
    }
  }
  return null;
}

function isDecisionIntent(s) {
  return DECISION_WORDS.some(w => s.includes(w)) || JUDGEMENT_WORDS.some(w => s.includes(w));
}

function classifyQuery(q) {
  const s = normalize(q);
  if (isDecisionIntent(s)) {
    const statusKb = matchStatusKB(s);
    if (statusKb) return { type: "kb_status", id: statusKb.id, text: statusKb.a };
  }
  const kb = matchKB(s);
  if (kb) return { type: "kb_general", id: kb.id, text: kb.a };
  if (isDecisionIntent(s) && [...s].length >= 6) return { type: "llm", text: "â†’ LLM è·¯å¾„" };
  return { type: "no_match", text: "æœªå‘½ä¸­" };
}

const questions = [
  // ä¸€ã€å¸‚åœºçŠ¶æ€ / ç¯å¢ƒåˆ¤æ–­ï¼ˆ1-20ï¼‰
  "ç°åœ¨å¸‚åœºæ•´ä½“æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿ",
  "å½“å‰æ˜¯åå¤šè¿˜æ˜¯åç©ºç¯å¢ƒï¼Ÿ",
  "ä»Šå¤©å¸‚åœºé£é™©é«˜ä¸é«˜ï¼Ÿ",
  "ç°åœ¨å±äºç‰›å¸‚ã€ç†Šå¸‚è¿˜æ˜¯éœ‡è¡ï¼Ÿ",
  "å¸‚åœºæ˜¯åœ¨åå¼¹è¿˜æ˜¯ä¸‹è·Œä¸­ç»§ï¼Ÿ",
  "å½“å‰è¡Œæƒ…ç®—ä¸ç®—æç«¯ï¼Ÿ",
  "ç°åœ¨æ˜¯è¶‹åŠ¿å¸‚è¿˜æ˜¯åŒºé—´å¸‚ï¼Ÿ",
  "å¸‚åœºæ˜¯åœ¨ç­‘åº•é˜¶æ®µå—ï¼Ÿ",
  "ç°åœ¨ç®—ä¸ç®—å±é™©é˜¶æ®µï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæ¿€è¿›è¿˜æ˜¯ä¿å®ˆï¼Ÿ",
  "ç°åœ¨æ•´ä½“æ˜¯é¡ºé£è¿˜æ˜¯é€†é£ï¼Ÿ",
  "å¸‚åœºæ˜¯åœ¨ä¿®å¤è¿˜æ˜¯æ¶åŒ–ï¼Ÿ",
  "å½“å‰è¡Œæƒ…å¯¹æ™®é€šäº¤æ˜“è€…å‹å¥½å—ï¼Ÿ",
  "å¸‚åœºæ˜¯å¦è¿›å…¥é«˜ä¸ç¡®å®šæ€§é˜¶æ®µï¼Ÿ",
  "ç°åœ¨æ˜¯æƒ…ç»ªä¸»å¯¼è¿˜æ˜¯ç†æ€§ä¸»å¯¼ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆè¯•é”™å—ï¼Ÿ",
  "å¸‚åœºæœ‰æ²¡æœ‰æ˜æ˜¾æ–¹å‘ï¼Ÿ",
  "ç°åœ¨æ›´åƒé£é™©é‡Šæ”¾å‰è¿˜æ˜¯ä¹‹åï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆç­‰å¾…å—ï¼Ÿ",
  "å¸‚åœºæ˜¯å¦è¿›å…¥é«˜æ³¢åŠ¨åŒºé—´ï¼Ÿ",

  // äºŒã€é£é™©æ„ŸçŸ¥ / é£é™©æ¥æºï¼ˆ21-40ï¼‰
  "å½“å‰æœ€å¤§çš„é£é™©æ˜¯ä»€ä¹ˆï¼Ÿ",
  "ç°åœ¨æœ€æ€•å‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ",
  "æœ‰æ²¡æœ‰ç³»ç»Ÿæ€§é£é™©åœ¨ç§¯ç´¯ï¼Ÿ",
  "å½“å‰é£é™©ä¸»è¦æ¥è‡ªå“ªé‡Œï¼Ÿ",
  "ä¼šä¸ä¼šçªç„¶å‡ºç°å¤§å¹…ä¸‹è·Œï¼Ÿ",
  "æœ‰æ²¡æœ‰ç±»ä¼¼å†å²å¤§è·Œå‰çš„ä¿¡å·ï¼Ÿ",
  "ç°åœ¨æ˜¯å‡åå¼¹å—ï¼Ÿ",
  "å½“å‰é£é™©æ˜¯çŸ­æœŸè¿˜æ˜¯ä¸­æœŸï¼Ÿ",
  "ç°åœ¨çš„é£é™©æ˜¯æ˜¾æ€§çš„è¿˜æ˜¯éšæ€§çš„ï¼Ÿ",
  "é£é™©æ˜¯åœ¨ä¸Šå‡è¿˜æ˜¯ä¸‹é™ï¼Ÿ",
  "å“ªç±»äººç°åœ¨æœ€å®¹æ˜“äºé’±ï¼Ÿ",
  "å½“å‰ç¯å¢ƒä¸‹æœ€å¤§çš„è¯¯åˆ¤é£é™©æ˜¯ä»€ä¹ˆï¼Ÿ",
  "é£é™©æ˜¯å¦å·²ç»è¢«å¸‚åœºå……åˆ†è®¡ä»·ï¼Ÿ",
  "ç°åœ¨æœ€éœ€è¦é˜²èŒƒçš„é£é™©äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ",
  "é£é™©é›†ä¸­åœ¨æƒ…ç»ªé¢è¿˜æ˜¯èµ„é‡‘é¢ï¼Ÿ",
  "æœ‰æ²¡æœ‰è¿é”é£é™©çš„å¯èƒ½ï¼Ÿ",
  "å½“å‰æ˜¯ä½é£é™©é«˜ä¸ç¡®å®šï¼Œè¿˜æ˜¯é«˜é£é™©ä½ä¸ç¡®å®šï¼Ÿ",
  "å¸‚åœºæ˜¯å¦æ¥è¿‘é£é™©æ‹ç‚¹ï¼Ÿ",
  "å¦‚æœå‡ºé—®é¢˜ï¼Œæœ€å¯èƒ½ä»å“ªé‡Œå¼€å§‹ï¼Ÿ",
  "ç°åœ¨æ˜¯å¦å­˜åœ¨è¸©è¸é£é™©ï¼Ÿ",

  // ä¸‰ã€ä»“ä½ç®¡ç† / é£é™©é¢„ç®—ï¼ˆ41-60ï¼‰
  "ç°åœ¨ä»“ä½åº”è¯¥æ€ä¹ˆæ§åˆ¶ï¼Ÿ",
  "å»ºè®®æ€»ä»“ä½æ§åˆ¶åœ¨å¤šå°‘ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæ»¡ä»“å—ï¼Ÿ",
  "ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥å‡ä»“ï¼Ÿ",
  "ç°åœ¨å¯ä»¥åŠ ä»“å—ï¼Ÿ",
  "å·²æœ‰ä»“ä½éœ€è¦è°ƒæ•´å—ï¼Ÿ",
  "è½»ä»“ä¸€èˆ¬æŒ‡å¤šå°‘æ¯”ä¾‹ï¼Ÿ",
  "ä»“ä½å¤ªé«˜ä¼šä¸ä¼šæœ‰é£é™©ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆé€æ­¥å»ºä»“å—ï¼Ÿ",
  "ç°åœ¨æ›´é€‚åˆæŒä»“è¿˜æ˜¯ç©ºä»“ï¼Ÿ",
  "å¦‚æœå·²ç»å¥—ä½äº†ï¼Œä»“ä½æ€ä¹ˆå¤„ç†ï¼Ÿ",
  "ç°åœ¨é€‚åˆåˆ†æ‰¹è¿›åœºå—ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæé«˜é£é™©æš´éœ²å—ï¼Ÿ",
  "ä»“ä½æ˜¯å¦éœ€è¦éšè¡Œæƒ…åŠ¨æ€è°ƒæ•´ï¼Ÿ",
  "ç°åœ¨é€‚åˆé˜²å®ˆå‹ä»“ä½å—ï¼Ÿ",
  "é‡ä»“ç”¨æˆ·ç°åœ¨æœ€åº”è¯¥åšä»€ä¹ˆï¼Ÿ",
  "å°ä»“ä½ç”¨æˆ·ç°åœ¨è¯¥ä¸è¯¥å‚ä¸ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæ‰©å¤§ä»“ä½å—ï¼Ÿ",
  "ä»“ä½æ§åˆ¶çš„é¦–è¦åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ",
  "ç°åœ¨ä»“ä½ç®¡ç†æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯æ˜¯ä»€ä¹ˆï¼Ÿ",

  // å››ã€äº¤æ˜“æ–¹å¼ / ç­–ç•¥é€‰æ‹©ï¼ˆ61-80ï¼‰
  "ç°åœ¨é€‚åˆåšçŸ­çº¿å—ï¼Ÿ",
  "å½“å‰ç¯å¢ƒæ›´é€‚åˆæ³¢æ®µè¿˜æ˜¯è§‚æœ›ï¼Ÿ",
  "é¡ºåŠ¿äº¤æ˜“ç°åœ¨æˆåŠŸç‡é«˜å—ï¼Ÿ",
  "é€†åŠ¿æŠ„åº•ç°åœ¨é è°±å—ï¼Ÿ",
  "ç°åœ¨é€‚åˆé«˜é¢‘äº¤æ˜“å—ï¼Ÿ",
  "ä½é¢‘ç­–ç•¥ç°åœ¨åˆé€‚å—ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆçªç ´ç­–ç•¥å—ï¼Ÿ",
  "éœ‡è¡å¸‚ç°åœ¨è¯¥æ€ä¹ˆäº¤æ˜“ï¼Ÿ",
  "ç°åœ¨é€‚åˆä¸»åŠ¨äº¤æ˜“è¿˜æ˜¯è¢«åŠ¨ç­‰å¾…ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæ¿€è¿›ç­–ç•¥å—ï¼Ÿ",
  "å“ªç§äº¤æ˜“æ–¹å¼ç°åœ¨é£é™©æœ€ä½ï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆæ–°æ‰‹äº¤æ˜“å—ï¼Ÿ",
  "ç°åœ¨é€‚åˆæé«˜äº¤æ˜“é¢‘ç‡å—ï¼Ÿ",
  "å½“å‰é˜¶æ®µé€‚åˆè¯•æ–°ç­–ç•¥å—ï¼Ÿ",
  "åšè¶‹åŠ¿äº¤æ˜“ç°åœ¨æ™šä¸æ™šï¼Ÿ",
  "å½“å‰ç¯å¢ƒé€‚åˆåšå¥—åˆ©å—ï¼Ÿ",
  "åšäº¤æ˜“ç°åœ¨æœ€å¤§çš„å‘æ˜¯ä»€ä¹ˆï¼Ÿ",
  "å½“å‰è¡Œæƒ…ä¸‹æœ€ä¸é€‚åˆä»€ä¹ˆç­–ç•¥ï¼Ÿ",
  "å¦‚æœä¸€å®šè¦äº¤æ˜“ï¼Œä¼˜å…ˆæ³¨æ„ä»€ä¹ˆï¼Ÿ",
  "å½“å‰é˜¶æ®µæœ€åˆç†çš„äº¤æ˜“æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ",

  // äº”ã€éªŒè¯ / è¿½é—® / ä¿¡å¿ƒç®¡ç†ï¼ˆ81-100ï¼‰
  "å’Œæ˜¨å¤©ç›¸æ¯”æœ‰å˜åŒ–å—ï¼Ÿ",
  "å½“å‰çŠ¶æ€ä¸€èˆ¬ä¼šæŒç»­å¤šä¹…ï¼Ÿ",
  "è¿‡å»ç±»ä¼¼è¡Œæƒ…é€šå¸¸æ€ä¹ˆèµ°ï¼Ÿ",
  "ç°åœ¨æ›´åƒå†å²ä¸Šçš„å“ªä¸€ç±»é˜¶æ®µï¼Ÿ",
  "è¿™ç§ç¯å¢ƒä¸‹æœºæ„é€šå¸¸æ€ä¹ˆåšï¼Ÿ",
  "ç°åœ¨çš„åˆ¤æ–­æœ‰å¤šç¡®å®šï¼Ÿ",
  "å¦‚æœæˆ‘ä»€ä¹ˆéƒ½ä¸åšï¼Œä¼šæ›´å®‰å…¨å—ï¼Ÿ",
  "å½“å‰ç»“è®ºæ˜¯å¦å®¹æ˜“è¢«æ‰“è„¸ï¼Ÿ",
  "ä»€ä¹ˆæ—¶å€™ç®—ç¯å¢ƒçœŸæ­£æ”¹å–„ï¼Ÿ",
  "å¦‚æœé£é™©ä¸‹é™ï¼Œä¸€èˆ¬å…ˆå‡ºç°ä»€ä¹ˆå˜åŒ–ï¼Ÿ",
  "å½“å‰åˆ¤æ–­çš„æ ¸å¿ƒä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ",
  "ç°åœ¨é€‚åˆç­‰å¾…ç¡®è®¤ä¿¡å·å—ï¼Ÿ",
  "å¦‚æœåˆ¤æ–­é”™äº†ï¼Œæœ€å¤§çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ",
  "ç°åœ¨æ˜¯å¿è€æœŸè¿˜æ˜¯è¡ŒåŠ¨æœŸï¼Ÿ",
  "å½“å‰ç¯å¢ƒæ›´é€‚åˆä¿æœ¬è¿˜æ˜¯åšå¼ˆï¼Ÿ",
  "ç°åœ¨çš„æœºä¼šæ˜¯å¦å€¼å¾—æ‰¿æ‹…é£é™©ï¼Ÿ",
  "å½“å‰ç¯å¢ƒä¸‹æœ€é‡è¦çš„çºªå¾‹æ˜¯ä»€ä¹ˆï¼Ÿ",
  "ä»€ä¹ˆæ—¶å€™åº”è¯¥é‡æ–°è¯„ä¼°åˆ¤æ–­ï¼Ÿ",
  "ç°åœ¨æ˜¯å¦éœ€è¦é™ä½é¢„æœŸï¼Ÿ",
  "å½“å‰é˜¶æ®µæœ€åˆç†çš„æ€»ä½“ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ",
];

const categories = [
  { name: "å¸‚åœºçŠ¶æ€/ç¯å¢ƒåˆ¤æ–­", range: [0, 20] },
  { name: "é£é™©æ„ŸçŸ¥/é£é™©æ¥æº", range: [20, 40] },
  { name: "ä»“ä½ç®¡ç†/é£é™©é¢„ç®—", range: [40, 60] },
  { name: "äº¤æ˜“æ–¹å¼/ç­–ç•¥é€‰æ‹©", range: [60, 80] },
  { name: "éªŒè¯/è¿½é—®/ä¿¡å¿ƒç®¡ç†", range: [80, 100] },
];

// è¯„åˆ†
function scoreResult(r) {
  if (r.type === "kb_status") {
    if (r.text.includes("ã€å¸‚åœºçŠ¶æ€ã€‘") && r.text.includes("ã€ä»“ä½å»ºè®®ã€‘")) return 5;
    if (r.text.includes("ã€")) return 4;
    return 3;
  }
  if (r.type === "kb_general") return 2;
  if (r.type === "llm") return 3;
  return 1;
}

// è¿è¡Œæµ‹è¯•
const results = questions.map((q, i) => {
  const r = classifyQuery(q);
  const score = scoreResult(r);
  return { idx: i + 1, question: q, type: r.type, id: r.id || "-", score, preview: (r.text || "").slice(0, 60).replace(/\n/g, " ") };
});

// ç»Ÿè®¡
console.log("ğŸ“Š 100 é—®å‹åŠ›æµ‹è¯•ç»“æœ\n");
console.log("=".repeat(70));

const total = results.length;
const avgScore = (results.reduce((s, r) => s + r.score, 0) / total).toFixed(2);
const dist = [0, 0, 0, 0, 0, 0];
results.forEach(r => dist[r.score]++);

console.log(`\næ€»é—®é¢˜æ•°: ${total}`);
console.log(`å¹³å‡å¾—åˆ†: ${avgScore}/5`);
console.log(`\nå¾—åˆ†åˆ†å¸ƒ:`);
console.log(`  5åˆ†(å®Œæ•´è£å†³): ${dist[5]} (${((dist[5]/total)*100).toFixed(1)}%)`);
console.log(`  4åˆ†(éƒ¨åˆ†è£å†³): ${dist[4]} (${((dist[4]/total)*100).toFixed(1)}%)`);
console.log(`  3åˆ†(LLMè·¯å¾„):  ${dist[3]} (${((dist[3]/total)*100).toFixed(1)}%)`);
console.log(`  2åˆ†(ç™¾ç§‘å›å¤): ${dist[2]} (${((dist[2]/total)*100).toFixed(1)}%)`);
console.log(`  1åˆ†(æœªå‘½ä¸­):   ${dist[1]} (${((dist[1]/total)*100).toFixed(1)}%)`);

console.log(`\nåˆ†ç±»å¾—åˆ†:`);
for (const cat of categories) {
  const catR = results.slice(cat.range[0], cat.range[1]);
  const catAvg = (catR.reduce((s, r) => s + r.score, 0) / catR.length).toFixed(2);
  const pass = catR.filter(r => r.score >= 4).length;
  console.log(`  ${cat.name}: ${catAvg}/5 (${pass}/${catR.length} å®Œæ•´è£å†³)`);
}

// è¯¦ç»†è¡¨æ ¼
console.log("\n" + "=".repeat(70));
console.log("è¯¦ç»†ç»“æœ:\n");
console.log("åºå· | å¾—åˆ† | ç±»å‹       | é—®é¢˜                           | å‘½ä¸­ID");
console.log("-".repeat(70));
results.forEach(r => {
  const icon = r.score >= 4 ? "âœ…" : r.score >= 3 ? "âš ï¸" : "âŒ";
  console.log(`${icon} ${String(r.idx).padStart(3)} | ${r.score}åˆ†  | ${r.type.padEnd(10)} | ${r.question.slice(0, 25).padEnd(25)} | ${r.id}`);
});

// ä½åˆ†é—®é¢˜
const lowScore = results.filter(r => r.score <= 2);
if (lowScore.length > 0) {
  console.log("\n" + "=".repeat(70));
  console.log(`\nâš ï¸ ä½åˆ†é—®é¢˜ (â‰¤2åˆ†) - å…± ${lowScore.length} æ¡:\n`);
  lowScore.forEach(r => console.log(`  [${r.idx}] ${r.question}`));
}

// ä¼˜åŒ–å»ºè®®
console.log("\n" + "=".repeat(70));
console.log("\nğŸ’¡ ä¼˜åŒ–å»ºè®®:\n");

// ç»Ÿè®¡æœªå‘½ä¸­å…³é”®è¯
const missedKW = {};
lowScore.forEach(r => {
  const words = r.question.match(/[\u4e00-\u9fa5]{2,}/g) || [];
  words.forEach(w => { missedKW[w] = (missedKW[w] || 0) + 1; });
});
const topMissed = Object.entries(missedKW).sort((a, b) => b[1] - a[1]).slice(0, 15);

if (dist[1] > 10) {
  console.log("1. å¤§é‡é—®é¢˜æœªå‘½ä¸­ KBï¼Œå»ºè®®æ‰©å…… status.json triggers");
}
if (dist[3] > 30) {
  console.log("2. è¿‡å¤šé—®é¢˜èµ° LLM è·¯å¾„ï¼Œå»ºè®®å¢åŠ  KB è¦†ç›–å‡å°‘ API æˆæœ¬");
}
if (topMissed.length > 0) {
  console.log("\nå»ºè®®æ·»åŠ åˆ° status.json triggers çš„é«˜é¢‘è¯:");
  topMissed.forEach(([w, c]) => console.log(`  "${w}" (å‡ºç° ${c} æ¬¡)`));
}

// è¾“å‡º CSV
const fs = require("fs");
const csv = [
  "åºå·,é—®é¢˜,ç±»å‹,å‘½ä¸­ID,å¾—åˆ†,å›å¤é¢„è§ˆ",
  ...results.map(r => `${r.idx},"${r.question}",${r.type},${r.id},${r.score},"${r.preview.replace(/"/g, '""')}"`)
].join("\n");
fs.writeFileSync("test-100-results.csv", csv);
console.log(`\nğŸ“ CSV å·²ä¿å­˜åˆ° test-100-results.csv`);
